<!DOCTYPE html>
<html>
<head>
   
    <!-- Required meta tags-->
    <meta charset="utf-8">
    
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
	
	
    <!-- Your app title -->
    <title>11 Foody</title>


	
	<link rel="stylesheet" href="lib/framework7/css/framework7.ios.css">
    <link rel="stylesheet" href="lib/framework7/css/framework7.ios.colors.css">
	
	
	
	
	
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
	
	<link href="https://fonts.googleapis.com/css?family=GFS+Didot" rel="stylesheet"> 
	
	<!--
	<link rel="stylesheet" type="text/css" href="css/swiper.min.css" />
	-->
</head>

<body>
    <!-- Status bar overlay for full screen mode (PhoneGap) -->
    <div class="statusbar-overlay"></div>
    <!-- Panels overlay-->
    <div class="panel-overlay"></div>
    <!-- Left panel with reveal effect-->
    <div class="panel panel-left panel-reveal">
      <div class="content-block">
        <p>Left panel content goes here</p>
      </div>
    </div>
    <!-- Views -->
    <div class="views">
      <!-- Your main view, should have "view-main" class -->
      <div class="view view-main">
        <!-- Top Navbar-->
		
		
        <div class="navbar">
          <div class="navbar-inner">
            
            
			<!--
			<div class="center sliding">ELEVEN FOODY</div>
            <div class="right">
              <a href="#" class="link icon-only open-panel"><i class="icon icon-bars"></i></a>
            </div>
			-->
          </div>
        </div>
		
		
        <!-- Pages container, because we use fixed-through navbar and toolbar, it has additional appropriate classes-->
        <div class="pages navbar-through toolbar-through">
          <!-- Page, "data-page" contains page name -->
          <div data-page="index" class="page no-navbar">
            <!-- Scrollable page content -->
            <div class="page-content indexBG">
				
				<div id="logo_page1">
					<img src="img/logo_line.png" />
				</div>
				<div id="slogan_page1">
					<img src="img/slogan_page1.png" />
				</div>
				
				<div id="langWrapper">
					<div id="btn_tw_wrapper"><div><a id="btn_lang_tw" href="#">中文</a></div></div>
					<div id="btn_en_wrapper"><div><a id="btn_lang_en" href="#">ENG</a></div></div>
				</div>
				
				<div>
					<a href="blue_print.html">藍圖</a>
				</div>
				
				<div id="gpsInfo"></div>
				
				
				
				<br /><br />
				<div onclick="login();">Login with Facebook</div>
				<br />
				<div onclick="logininfo();">logininfo</div>
				<br />
				<div onclick="logout();">Logout with Facebook</div>
				
			
				
            </div>
          </div>
        </div>
		
        <!-- Bottom Toolbar-->
		<!--
        <div class="toolbar">
          <div class="toolbar-inner">
            
            <a href="#" class="link">Link 1</a>
            <a href="#" class="link">Link 2</a>
          </div>
        </div>
		-->
		
		
      </div>
    </div>

	
	
	
	
	
	<!-- Order Confirmed Popup -->
	<div class="popup popup-order-comfirmed">
	<div class="content-block" id="orderConfirmNotiWrap">
	  
		<div>
		<img src="img/order_04_icon.png" />
		</div>
		<h1>Order Confirmed</h1>
		<p>訂單確認</p>


		<p><a href="#" class="close-popup"><img src="img/order_04_icon_check.png" /></a></p>

	</div>
	</div>
	
	
	 <!-- Term & Condition Popup -->
		<div class="popup popup-condition-tw">
		<div class="content-block">
		  
			
			<h3>服務及使用條款</h3>

			<p><a href="#" class="close-popup">關閉</a></p>
			<p>服務及使用條款  Lorem ipsum dolor ...</p>

		</div>
		</div>
	  
	  
	  
	<!-- Term & Condition Popup -->
	  <div class="popup popup-term-en">
		<div class="content-block">
		  <p>Terms and Conditions</p>
		  <p><a href="#" class="close-popup">Close</a></p>
		  <p>Terms and Conditions Lorem ipsum dolor ...</p>
		</div>
	  </div>
	
	
	
	<div id="fb-root"></div>

	
    <script type="text/javascript" src="cordova.js"></script>
	 
	 
	<script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
	<script type="text/javascript" src="lib/framework7/js/framework7.min.js"></script>


	<script type="text/javascript" src="js/init.js"></script>
	<script type="text/javascript" src="js/index.js"></script>
	<script type="text/javascript" src="js/pages.js"></script>
	<script type="text/javascript" src="js/swiper.min.js"></script>
	<script src="openfb.js"></script>
	
	
	
	<!--
	<script type="text/javascript" src="js/jquery.cycle.all.js"></script>
	
	<script type="text/javascript" src="js/jquery.bxslider.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/jquery.bxslider.css" />
	-->
	
	
    <script type="text/javascript">
        //app.initialize();
		
    </script>
	
	
	
	<script src="https://www.gstatic.com/firebasejs/3.5.3/firebase.js"></script>
	<script>
		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyBXMWaXV5KG8PXZcrI6ZUt_Lwo7MHonDn0",
			authDomain: "foodytest-b1f3e.firebaseapp.com",
			databaseURL: "https://foodytest-b1f3e.firebaseio.com",
			storageBucket: "foodytest-b1f3e.appspot.com",
			messagingSenderId: _senderID
		};
		
		firebase.initializeApp(config);

	  
	</script>
	
	
	
	<!-- open FB -->
	<script>

			 // Defaults to sessionStorage for storing the Facebook token
			 openFB.init({appId: $_fbaid});

			//  Uncomment the line below to store the Facebook token in localStorage instead of sessionStorage
			//  openFB.init({appId: 'YOUR_FB_APP_ID', tokenStore: window.localStorage});

			function loginopen() {
				openFB.login(
						function(response) {
							if(response.status === 'connected') {
								alert('Facebook login succeeded, got access token: ' + response.authResponse.accessToken);
								
								getInfo();
								
								
							} else {
								alert('Facebook login failed: ' + response.error);
							}
						}, {scope: 'email,publish_actions,public_profile'});	
						//The permissions offline_access and publish_stream are deprecated
						//public_profile
						//email,read_stream,publish_actions
			}

			function getInfo() {
				openFB.api({
					path: '/me',
					success: function(data) {
						console.log(JSON.stringify(data) + data.name + 'http://graph.facebook.com/' + data.id + '/picture?type=small');
						
						alert(data.name);
						alert('http://graph.facebook.com/' + data.id + '/picture?type=small');
						
						
						/*
						
						$_create_profile['m_name'] = $_POST['username'];
						$_create_profile['m_phone'] = $_POST['userphone'];
						$_create_profile['m_photo_path'] = $_POST['imgPath'];
						$_create_profile['m_rid'] = $_POST['rid'];
						$_create_profile['m_register_date'] = date("Y-m-d" ,  $_timestamp);
						$_create_profile['m_register_time'] = date("H:i:s" ,  $_timestamp);
						$_create_profile['m_password'] = hashPassword($_user_password);
						
						{"id":"10211106882216654","email":"jamesinsummer@gmail.com","first_name":"James","gender":"male","last_name":"Liu","link":"https://www.facebook.com/app_scoped_user_id/10211106882216654/","locale":"en_US","name":"James Liu","timezone":8,"updated_time":"2015-07-09T16:43:43+0000","verified":true}
						*/
						
						postData = {"username":data.name , "userphone":"" , "imgPath":'http://graph.facebook.com/' + data.id + '/picture?type=large' , "rid":localStorage.getItem('registrationId') , "m_gender":data.gender , "m_email":data.email , "m_fbuserid":data.id};
						_thetimestamp = Math.round(+new Date()/1000);
						//Save to database
						$.ajax({
							type: 'POST',
							data: postData,
							crossDomain: true,
							url: $_server_saveDB + "?thetimestamp=" + _thetimestamp,
							success: function(data){
								console.log("回傳:" + data + "END");
								//alert(data);
								//alert('Your profile was successfully added');
								
								
								if (data.search("Done")>=0) {
									if (_lang_index === 0) {
										alert("FB 建檔成功。");
									} else {
										alert("FB Sigin Successed!")
									}
									
									//Redirect to Login page
										mainView.router.load({
											url: 'login.html',
											context: Template7.data.languages.lang_signuporlogin[_lang_index] 
										});
									
									
								} else {
									//已經建檔了 直接彈回 signorlogin
									alert("直接彈回 signorlogin");
									
										mainView.router.load({
											url: 'signorlogin.html',
											context: Template7.data.languages.lang_signuporlogin[_lang_index] 
										});
									
								}
								
								
								
							},
							error: function(data){
								console.log(data);
								//alert('There was an error adding your profile');
							}
						});
						
						
						//document.getElementById("userName").innerHTML = data.name;
						//document.getElementById("userPic").src = 'http://graph.facebook.com/' + data.id + '/picture?type=small';
					},
					error: errorHandler});
			}

			function share() {
				openFB.api({
					method: 'POST',
					path: '/me/feed',
					params: {
						message: document.getElementById('Message').value || 'Testing Facebook APIs'
					},
					success: function() {
						alert('the item was posted on Facebook');
					},
					error: errorHandler});
			}

			function readPermissions() {
				openFB.api({
					method: 'GET',
					path: '/me/permissions',
					success: function(result) {
						alert(JSON.stringify(result.data));
					},
					error: errorHandler
				});
			}

			function revoke() {
				openFB.revokePermissions(
						function() {
							alert('Permissions revoked');
						},
						errorHandler);
			}

			function logoutopen() {
				openFB.logout(
						function() {
							alert('Logout successful');
						},
						errorHandler);
			}

			function errorHandler(error) {
				alert(error.message);
			}

	</script>
	
	
	<!-- Facebook4 login need -->
	<script>
	
	
		//facebookConnectPlugin.api( "me?fields=name,id,email,gender,birthday", [ 'public_profile' , "user_birthday"],
		var logininfo = function () {
			facebookConnectPlugin.api( "me?fields=name,id,email,gender,birthday", [ 'public_profile'],
			
			function (result) {
			
				//alert("Result: " + JSON.stringify(result) + result['email']);
				
				console.log("Result: " + JSON.stringify(result));
				
				//{"name":"James Liu","id":"10211107519312581","email":"jamesinsummer@gmail.com","gender":"male","birthday":"10/19/1970"}
				
				postData = {"username":result['name'] , "userphone":"" , "imgPath":'http://graph.facebook.com/' + result['id'] + '/picture?type=large' , "rid":localStorage.getItem('registrationId') , "m_gender":result['gender'] , "m_email":result['email'] , "m_fbuserid":result['id']};
						_thetimestamp = Math.round(+new Date()/1000);
						//Save to database
						$.ajax({
							type: 'POST',
							data: postData,
							crossDomain: true,
							url: $_server_saveDB + "?thetimestamp=" + _thetimestamp,
							success: function(data){
								console.log("回傳:" + data + "END");
								//alert(data);
								//alert('Your profile was successfully added');
								
								
								if (data.search("Done")>=0) {
									if (_lang_index === 0) {
										alert("FB 建檔成功。");
									} else {
										alert("FB Sigin Successed!")
									}
									
									//Redirect to Login page
										mainView.router.load({
											url: 'login.html',
											context: Template7.data.languages.lang_signuporlogin[_lang_index] 
										});
									
									
								} else {
									//已經建檔了 直接彈回 signorlogin
									alert("直接彈回 signorlogin");
									
										mainView.router.load({
											url: 'signorlogin.html',
											context: Template7.data.languages.lang_signuporlogin[_lang_index] 
										});
									
								}
								
								
								
							},
							error: function(data){
								console.log(data);
								//alert('There was an error adding your profile');
							}
						});
						
				
				
				
			},
			function (error) {
				alert("Failed: " + error);
			});
		}
		
		
		
		var login = function () {
				if (window.cordova.platformId == "browser") {
								var appId = prompt("Enter FB Application ID", "");
								facebookConnectPlugin.browserInit(appId);
							}
							
							
					//'email,publish_actions,public_profile'
					facebookConnectPlugin.login(["public_profile", "email"], 
					function (result) { 
						
						//alert(JSON.stringify(result));
						
						console.log("test 1 : " + JSON.stringify(result));
						//alert('Good to see you, ' + result['authResponse']['userID'] + " , "  + result['status']);
						console.log("test 2 : " + result['authResponse']['userID']  + " , "  + result['authResponse']['userID'] ); 
						console.log("user img : " + 'http://graph.facebook.com/' + result['authResponse']['userID'] + '/picture?type=large');
						
						
						if (result['status']=="connected") {
							//登入成功
							//alert("登入成功");
							logininfo();
						}
						
						/*
						{"status":"connected","authResponse":{"accessToken":"EAADfHIftTToBAGuePikEgNSy9ugdd4nILf009jvZAXuzJ2qYBpjTFHvNoxIRRshacMCBElBN1UBeVDdYZA8I1GOzGeByz2KgTH4SrZAHm8RsayJFZCyZBKorhNrTEqySwkZAJR67Tvhl51AHrde4Y5JUk0wEhdx49Ep6cvQZCCa7hWm7TpWlcR98ZCFkOvcTqNQp3RWWHcSya53DetgOizVp","expiresIn":"5095770","session_key":true,"sig":"...","userID":"10211107519312581"}}
						*/
						
						
					},
                   function (errorlogin) { 
						alert(JSON.stringify(errorlogin)) 
						console.log("Error : " + JSON.stringify(errorlogin));
					});
			
			
		}
		
		
		var logout = function () { 
                facebookConnectPlugin.logout( 
                    function (response) { alert(JSON.stringify(response)) },
                    function (response) { alert(JSON.stringify(response)) });
            }
		
            
         //下面沒什麼用  
            
		
		
			 var getAccessToken = function () { 
				facebookConnectPlugin.getAccessToken( 
					function (response) { alert(JSON.stringify(response)) },
					function (response) { alert(JSON.stringify(response)) });
				}
			
			
			var getStatus = function () { 
				facebookConnectPlugin.getLoginStatus( 
					function (response) { alert(JSON.stringify(response)) },
					function (response) { alert(JSON.stringify(response)) });
				}
			
			
			
			var showDialog = function () { 
					facebookConnectPlugin.showDialog( { method: "feed" }, 
						function (response) { alert(JSON.stringify(response)) },
						function (response) { alert(JSON.stringify(response)) });
				}
	</script>
	

	
	
	
</body>

</html>
